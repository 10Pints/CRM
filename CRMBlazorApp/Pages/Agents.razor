@page "/agents"
@using CRM.Blazor.Services
@using CRM.DataAccess.Models

@inject AgentService AgentService

<PageTitle>Agents</PageTitle>

<h3>Agents</h3>

<p>This is the Agents page.</p>

<div class="mb-4 p-4 border rounded-lg shadow-sm">
   <h4 class="font-semibold mb-2">Search Criteria</h4>
   <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      <div>
         <label class="block text-sm font-medium text-gray-700">First Name</label>
         <input @bind="searchCriteria.FirstName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2" />
      </div>
      <div>
         <label class="block text-sm font-medium text-gray-700">Last Name</label>
         <input @bind="searchCriteria.LastName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2" />
      </div>
      <div>
         <label class="block text-sm font-medium text-gray-700">Phone Number</label>
         <input @bind="searchCriteria.PhoneNumber" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2" />
      </div>
      <div>
         <label class="block text-sm font-medium text-gray-700">Email</label>
         <input @bind="searchCriteria.Email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2" />
      </div>
   </div>
   <div class="mt-4">
      <button class="btn btn-primary" @onclick="SearchAgents">Search Agents</button>
   </div>
</div>

@if (agents == null)
{
   <p><em>Loading...</em></p>
}
else
{
   <table class="table">
      <thead>
         <tr>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Phone Number</th>
            <th>Email</th>
         </tr>
      </thead>
      <tbody>
         @foreach (var agent in agents)
         {
            <tr>
               <td>@agent.FirstName</td>
               <td>@agent.LastName</td>
               <td>@agent.PhoneNumber</td>
               <td>@agent.Email</td>
            </tr>
         }
      </tbody>
   </table>
}

@code {
   private List<Agent> agents = new();
   private Agent searchCriteria = new();

   protected override async Task OnInitializedAsync()
   {
      await SearchAgents();
   }

   private async Task SearchAgents()
   {
      // This is a placeholder for the actual search logic.
      // We will update the AgentService to handle the criteria next.
      agents = await AgentService.GetAgentsAsync() ?? new();
   }
}
